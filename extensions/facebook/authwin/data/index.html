<?xml version="1.0" encoding="utf-8"?>
<!-- CopyLeft (c) PlexyPlanet.org -->

<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link href="style.css" rel="stylesheet" type="text/css" />

    <title>Facebook Feed Wall</title>
    <script>
     function onDataReady(data)
     {
        if (data["command"] == "userfeed") {
            //document.write(data["rawdata"] + " <br>");
            var obj = JSON.parse(data["rawdata"]);
            document.write ("Data:" + obj.id);
            document.write ("feed:" + obj.feed.data[0].message);
        }
     }
     
     function start()
     {
         window.onresize = bubbleResized;
         
         if (FacebookEngine) {
             var args = {};
             args["command"] = "wallpost";
             args["token"] = ContactCard.token();
             args["id"] = ContactCard.facebookId();
             var userImage = ContactCard.userImage();
             
             FacebookEngine.requestData(args);
             FacebookEngine.sourceUpdated.connect(onDataReady);
             
             //if (userImage != null)
                 //userImage.assignToHTMLImageElement(document.getElementById("userPicture0"));
         }

       
     }

    function bubbleResized ()
    {
       var items = document.getElementsByClassName ("bubble");

       for (i = 0 ; i < items.length ; i++) {
           var textNode = document.getElementById ("content_" + i);
           var imgNode = document.getElementById("img_" + i);
           if (textNode) {
               console.log (textNode.clientHeight);
               var height = 100;
               height += textNode.clientHeight;
                    
               if (imgNode) {
                   console.log ("img Node" + imgNode.height);
                   height += imgNode.clientHeight;
                }
                items[i].style.height =  height + "px";
            }
       }
    }

    function onImageLoadResize()
    {
       console.log("Image loaded");
       bubbleResized();
    }
    function addFeedItem (id, text, img)
    {
       var content = "<div class=\"bubble\" onresize=\"bubbleResized()\" >" +
                     "<img class=\"circle\" id=\"userPicture0\" src=\"http://www.theipadguide.com/images/facebook50x50.jpg\"></img>"  +
                     "<p class=\"bubbletext\"  id=\"content_" + id + "\">" +
                     text +
                     "</p>" +
                     "<div style=\"margin-top:120px;\"> <img id=\"img_"+ id +"\" onload=\"onImageLoadResize();\" class=\"imagedropshadow\" src=\""+ img +"\"></img></div>"  +
                     "</div>";

       var parent = document.getElementById ("feed_parent");

       if (parent) {
           parent.innerHTML += content;

           var items = document.getElementsByClassName ("bubble");
           

           for (i = 0 ; i < items.length ; i++) {
                var textNode = document.getElementById ("content_" + id);
                var imgNode = document.getElementById("img_" + id);
                items[i].style.opacity = "1.0";
           
                if (textNode) {
                    console.log (textNode.clientHeight);
                    var height = 100;
                    height += textNode.clientHeight;
                    
                    if (imgNode) {
                        height += imgNode.clientHeight;
                    }
                    items[i].style.height =  height + "px";
                }
           }
       }
    }
    
    </script>
</head>

<body onload="start();">
    <section id="feed_parent">
      <script>
      </script>
    </section>
</body>
</html>
